<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Store Inventory">
    <meta name="keywords" content="item inventory, expire checker, HTML, CSS, JavaScript, Firebase">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../design.css">
    <link rel="stylesheet" href="../responsive.css">
    <script type="module" src="../sameFunc.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>

    <title>Items To Expire | Inventory System</title>
</head>

<body>
    <header>
        <div class="web-name">
            <img src="../images/logo.png" alt="img" style="height: 2.6rem;">
        </div>
        <div class="signout-contain">
            <button class="menu_bttn">
                <svg xmlns="http://www.w3.org/2000/svg" class="menu_icon"
                    viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z" />
                </svg>
            </button>
            <div class="account-container padding1">
                <div class="close-menu">&Cross;</div><br>
                <div class="flex align-center justify-center" style="width: 100%;">
                    <img src="" alt="img" class="profile-img" style="border-radius: 50%; width: 3rem; height: 3rem;">
                </div>
                <div class="flex-1" style="width: 100%; text-align: center;">
                    <div id="user-email"></div>
                </div>
                <div class="account-manage-container" style="border-radius: 15px; background-color: white;">
                    <span id="manage-option">
                        <a href="#" class="link-option padding1 flex-1 align-center" style="color: #202020;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="manage-icons"
                                viewBox="0 0 640 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                                <path
                                    d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z" />
                            </svg>
                            Link to an account?
                        </a>
                    </span>
                    <span id="manage-option">
                        <a href="../manage.html" class="manage-account flex-1 padding1 align-center"
                            style="color: #202020;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="manage-icons"
                                viewBox="0 0 640 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                                <path
                                    d="M224 0a128 128 0 1 1 0 256A128 128 0 1 1 224 0zM178.3 304h91.4c11.8 0 23.4 1.2 34.5 3.3c-2.1 18.5 7.4 35.6 21.8 44.8c-16.6 10.6-26.7 31.6-20 53.3c4 12.9 9.4 25.5 16.4 37.6s15.2 23.1 24.4 33c15.7 16.9 39.6 18.4 57.2 8.7v.9c0 9.2 2.7 18.5 7.9 26.3H29.7C13.3 512 0 498.7 0 482.3C0 383.8 79.8 304 178.3 304zM436 218.2c0-7 4.5-13.3 11.3-14.8c10.5-2.4 21.5-3.7 32.7-3.7s22.2 1.3 32.7 3.7c6.8 1.5 11.3 7.8 11.3 14.8v17.7c0 7.8 4.8 14.8 11.6 18.7c6.8 3.9 15.1 4.5 21.8 .6l13.8-7.9c6.1-3.5 13.7-2.7 18.5 2.4c7.6 8.1 14.3 17.2 20.1 27.2s10.3 20.4 13.5 31c2.1 6.7-1.1 13.7-7.2 17.2l-14.4 8.3c-6.5 3.7-10 10.9-10 18.4s3.5 14.7 10 18.4l14.4 8.3c6.1 3.5 9.2 10.5 7.2 17.2c-3.3 10.6-7.8 21-13.5 31s-12.5 19.1-20.1 27.2c-4.8 5.1-12.5 5.9-18.5 2.4l-13.8-7.9c-6.7-3.9-15.1-3.3-21.8 .6c-6.8 3.9-11.6 10.9-11.6 18.7v17.7c0 7-4.5 13.3-11.3 14.8c-10.5 2.4-21.5 3.7-32.7 3.7s-22.2-1.3-32.7-3.7c-6.8-1.5-11.3-7.8-11.3-14.8V467.8c0-7.9-4.9-14.9-11.7-18.9c-6.8-3.9-15.2-4.5-22-.6l-13.5 7.8c-6.1 3.5-13.7 2.7-18.5-2.4c-7.6-8.1-14.3-17.2-20.1-27.2s-10.3-20.4-13.5-31c-2.1-6.7 1.1-13.7 7.2-17.2l14-8.1c6.5-3.8 10.1-11.1 10.1-18.6s-3.5-14.8-10.1-18.6l-14-8.1c-6.1-3.5-9.2-10.5-7.2-17.2c3.3-10.6 7.7-21 13.5-31s12.5-19.1 20.1-27.2c4.8-5.1 12.4-5.9 18.5-2.4l13.6 7.8c6.8 3.9 15.2 3.3 22-.6c6.9-3.9 11.7-11 11.7-18.9V218.2zm92.1 133.5a48.1 48.1 0 1 0 -96.1 0 48.1 48.1 0 1 0 96.1 0z" />
                            </svg>
                            Manage your account
                        </a>
                    </span>
                    <span id="manage-option">
                        <a href="#" class="signout-option flex-1 padding1 align-center" style="color: #202020;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="manage-icons"
                                viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                                <path
                                    d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 192 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l210.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128zM160 96c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 32C43 32 0 75 0 128L0 384c0 53 43 96 96 96l64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l64 0z" />
                            </svg>
                            Sign out
                        </a>
                    </span>
                </div>
            </div>
        </div>
    </header>
    <main>
        <div class="item-display">
            <div class="item-status-container">
                <a href="../home.html" class="item-all container">
                    All Items
                    <div class="item-quantity">0</div>
                </a>
                <a href="./available.html" class="item-available container">
                    Available Items
                    <div class="available">0</div>
                </a>
                <a href="./toexpire.html" class="item-to-expire container active">
                    Items To Expire
                    <div class="almost">0</div>
                </a>
                <a href="./expired.html" class="item-expired container">
                    Expired Items
                    <div class="expired">0</div>
                </a>
            </div>
            <div class="items-container">
                <div class="nav-title">
                    <p class="title-nav">To Expired Items</p>
                </div>
                <div class="search-container">
                    <div class="search-with-button">
                        <input class="search" type="search" name="search">
                        <button class="search-button">
                            <img class="search-icn" src="../images/search_icon.png" alt="img">
                        </button>
                    </div>
                    <button class="add-item-bottom">
                        <!-- <img class="bttm-add" src="./images/add_icon.png" alt="img"> -->
                        <svg class="bttm-add" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 512">
                            <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                            <path
                                d="M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z" />
                        </svg>
                        <div class="table-option-container">
                            <span class="table-option table-add">Add Item</span>
                            <span class="table-option table-delete">Delete Table</span>
                        </div>
                    </button>
                </div>
                <div class="table-container">
                    <table class="items">
                        <thead>
                            <th>Item ID</th>
                            <th>Item Name</th>
                            <th>Item Price</th>
                            <th>Batch no#</th>
                            <th>Manufactured Date</th>
                            <th>Expiration Date</th>
                            <th class="date-added">Date Added</th>
                            <th></th>
                        </thead>
                        <tbody class="item-body">

                        </tbody>
                    </table>
                    <div style="height: 3rem;"></div>
                </div>
            </div>
        </div>
        <div class="add-item-section">
            <div class="add-item-container">
                <div class="add-item-text">Add Item <span class="exit-add"
                        style="float: right; display: none; cursor: pointer; ">&Cross;</span></div>
                <input class="item-name" required type="text" placeholder="Item name...">
                <input class="item-price" required type="text" placeholder="Item price...">
                <div style="display: flex; align-items: center; gap: 5px; margin-top: 3px;">
                    <input class="item-unit" required type="number" placeholder="Batch no#...">
                    <input class="item-qnty" required type="number" placeholder="Quantity...">
                </div>
                <label for="manufactured">Manufactured Date</label>
                <input class="manufactured-date" id="manufactured" required type="date" name="manufactured">
                <label for="expiry-date">Expiry Date</label>
                <input class="expiry-date" id="expiry-date" required type="date" name="expiry-date">
                <input class="add-item" type="button" name="add-item" value="Add Item">
            </div>
            <div class="recent-items-container">
                <h3 align="center" style="font-family: poppins;">Recent items added</h3>
                <ul class="recent-items" style="list-style: none; padding: 0.3rem;">

                </ul>
            </div>
        </div>
        <div class="item-info-container hidden">
            <span class="flex" style="align-items: center;">
                <span class="flex">
                    <p style="color: #7E7E7E;">Batch no.</p>
                    <input type="number" class="batch-number">
                </span>
                <div class="close-info">&Cross;</div>
            </span>
            <div class="info-inner-container">
                <span class="flex">
                    <input type="text" class="item-info-name">
                    <span class="flex" style="align-items: center;">
                        <input type="number" class="item-info-qnty">
                        <p>pcs</p>
                    </span>
                </span>
                <span class="flex" style="align-items: center;">
                    <p style="font-size: 32px; width: 10%; font-weight: bold;">â‚±</p>
                    <input type="number" class="item-info-price">
                </span>
                <span class="flex">
                    <label for="item-info-expiry">Expiry: </label>
                    <input type="date" id="item-info-expiry">
                </span>
                <span class="flex">
                    <label for="item-info-manufactured">Manufactured: </label>
                    <input type="date" id="item-info-manufactured">
                </span>
                <span class="flex">
                    <label for="item-info-added">Added: </label>
                    <input type="date" id="item-info-added" style="text-align: right;">
                </span>
                <span class="flex" style="gap: 1rem;">
                    <button class="item-info-edit">Edit</button>
                    <button class="item-info-update">Update</button>
                </span>
            </div>
            <div class="item-info-id" style="text-align: right;"></div>
        </div>
    </main>
    <div class="bottom-fix"></div>
    <section>
        <div class="menu-container">
            <a href="../home.html" class="item-all-link bttm">
                <span class="item-quantity status-number">0</span>
                <img class="status-icn" src="../images/allitems_icon.png" alt="img">
            </a>
            <a href="./available.html" class="item-available-link bttm">
                <span class="available status-number">0</span>
                <img class="status-icn" src="../images/available_icon.png" alt="img">
            </a>
            <div class="add-item-link bttm">
                <img class="mid-add" src="../images/add_icon.png" alt="img">
            </div>
            <a href="./toexpire.html" class="item-to-expire-link bttm active-bttm">
                <span class="almost status-number">0</span>
                <img class="status-icn" src="../images/toexpired_icon.png" alt="img">
            </a>
            <a href="./expired.html" class="item-expired-link bttm">
                <span class="expired status-number">0</span>
                <img class="status-icn" src="../images/expired_icon.png" alt="">
            </a>
        </div>
    </section>
    <script src="../config.js" type="module"></script>
    <script type="module">
        import firebaseConfig from "../config.js";
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, deleteUser, GoogleAuthProvider, signInWithPopup, linkWithPopup } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";
        import {
            getDatabase, ref, push, onValue, child,
            remove, set, query, orderByChild, get,
            startAt, endAt, limitToLast
        } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        import { openAdd, showItemOption, hideContainers } from "../sameFunc.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        var toex_id = [];

        var is_Anonymous = "";

        onAuthStateChanged(auth, (user) => {
            const profile = document.querySelector(".profile-img");
            const photo_guest = "../images/guest.svg";

            if (!user) {
                window.location = "index.html";
            }
            else if (user.isAnonymous != true) {
                user.emailVerified != true ? window.location = "verify.html" : user;

                const photo_email = `${user.photoURL}`;
                const photo_password = "../images/user.svg";
                const provider = user.providerData[0].providerId;
                const photo_linked = user.providerData[0].photoURL;

                document.querySelector(".link-option").parentElement.style.display = "none";
                switch (provider) {
                    case "google.com":
                        user.photoURL == null ? profile.setAttribute("src", photo_linked) : profile.setAttribute("src", photo_email);
                        break;

                    case "password":
                        profile.setAttribute("src", photo_password);
                        break;

                    default:
                        profile.setAttribute("src", photo_guest);
                        break;
                }
                loadData();
                getRecent();
            }
            else if (user.isAnonymous == true) {
                is_Anonymous = true;
                profile.setAttribute("src", photo_guest);
                document.querySelector(".manage-account").parentElement.style.display = "none";
                loadData();
                getRecent();
            }
            document.querySelector("#user-email").textContent = user.email;
        });

        //select classes of menu button and the container
        const account_menu = document.querySelector(".menu_bttn");
        const account_container = document.querySelector(".account-container");
        account_menu.onclick = () => {                      //function that would display the menu
            account_container.style.display = "block";
        }

        //select class of close-menu
        const close_menu = document.querySelector(".close-menu");
        close_menu.onclick = () => {
            account_container.style.display = "none";
        }

        //select class for link account
        const link_btn = document.querySelector(".link-option");
        link_btn.addEventListener("click", () => {
            const provider = new GoogleAuthProvider();
            var user = auth.currentUser;

            linkWithPopup(user, provider)
                .then((userr) => {
                    window.location = "home.html";
                })
                .catch((err) => {
                    console.log(err);
                })

        });

        //select class of signout button
        const buttonout = document.querySelector(".signout-option");
        //signout function
        buttonout.onclick = () => {
            if (is_Anonymous == true) {
                var confirmation = confirm("You're currently logged in as guest, your data would be deleted if you logout. Continue to logout?");
                var user = auth.currentUser;
                var reff = ref(db, `User/${user.uid}/`);
                if (confirmation == true) {
                    deleteUser(user);
                    reff ? remove(reff) : confirmation;
                }
            } else {
                auth.signOut();
            }
        }

        //if all items container is clicked
        var getAll = document.querySelector(".item-all");
        var bttmAll = document.querySelector(".item-all-link");
        getAll.addEventListener("click", () => {
            location.reload();
        });
        bttmAll.addEventListener("click", () => {
            location.reload();
        });

        const exit_add = document.querySelector(".exit-add");
        exit_add.addEventListener("click", () => {
            const add_section = document.querySelector(".add-item-section");
            add_section.classList.remove("show");
            exit_add.style.display = "none";
        })

        //add box shadow when the container is clicked
        var itemcontainer = document.querySelectorAll(".container");
        for (let i = 0; i < itemcontainer.length; i++) {
            itemcontainer[i].onclick = function () {
                var first_container = itemcontainer[0];
                while (first_container) {
                    if (first_container.tagName === "DIV") {
                        first_container.classList.remove("active");
                    }
                    first_container = first_container.nextSibling;
                }
                this.classList.add("active");
            }
        }

        //add box shadow when the container is clicked
        const bttmcontainer = document.querySelectorAll(".bttm");
        const crr_active = document.querySelector(".item-to-expire-link");
        bttmcontainer.forEach(tag => {
            tag.addEventListener("click", () => {
                crr_active.classList.remove("active-bttm");
                tag.classList.add("active-bttm");
            });
        })

        //search button function section
        var serch = document.querySelector(".search-button");
        serch.addEventListener("click", search);

        //add item link function section
        var add_link = document.querySelector(".add-item-link");
        var add_bottom = document.querySelector(".add-item-bottom");
        var table_add = document.querySelector(".table-add");
        add_link.addEventListener("click", openAdd);
        add_bottom.addEventListener("click", openTableOptions);
        table_add.addEventListener("click", openAdd);

        //select delete button in table option
        const table_delete = document.querySelector(".table-delete");
        table_delete.addEventListener("click", deleteTable);

        //select add item button class
        var add = document.querySelector(".add-item");
        //add item button function
        add.addEventListener("click", () => {
            const user = auth.currentUser;
            const item_id = push(child(ref(db), 'Items')).key;
            var item_name = document.querySelector(".item-name").value;
            var item_price = document.querySelector(".item-price").value;
            var item_unit = document.querySelector(".item-unit").value;
            var item_qnty = document.querySelector(".item-qnty").value;
            var manufactured = document.querySelector(".manufactured-date").value;
            var expiry = document.querySelector(".expiry-date").value;
            var d = new Date();
            var month = d.getMonth() + 1;
            var date = d.getUTCDate();
            var year = d.getUTCFullYear();

            if (item_name == "" || item_price == "" || manufactured == "") {
                alert("Please input all the data needed.");
            }
            else {
                expiry == "" ? expiry = "No Expiry Date" : expiry = expiry;
                push(ref(db, `User/${user.uid}/Items/`), {
                    item_name: item_name,
                    item_price: item_price,
                    manufactured: manufactured,
                    expiry: expiry,
                    added: year + "-" + month + "-" + date,
                    batch_no: item_unit,
                    item_qnty: item_qnty
                });
                removeTable();
                alert("Item Added!");
                location.reload();
            }
        });

        function loadData() {
            //items status
            var item_num = 0;
            var item_at_hand = 0;
            var item_near = 0;
            var item_exp = 0;
            const user = auth.currentUser;

            //get data in database
            const item = ref(db, `User/${user.uid}/Items`); //initialize database reference

            remove(ref(db, `User/${user.uid}/Available/`)); //remove data in each reference to delete data that is not suited in that status
            remove(ref(db, `User/${user.uid}/Expired/`));
            remove(ref(db, `User/${user.uid}/To Expire/`));

            onValue(item, (snapshot) => {
                snapshot.forEach(function (childSnap) {
                    const data = childSnap.val();
                    var snap_item_id = childSnap.key;
                    var snap_itemn = data.item_name;
                    var snap_itemp = data.item_price;
                    var snap_manufactured = data.manufactured;
                    var snap_expiry = data.expiry;
                    var snap_added = data.added;
                    var snap_batch = data.batch_no;

                    item_num++;

                    checkStatus(user.uid, snap_item_id, snap_itemn, snap_itemp, snap_manufactured, snap_expiry, snap_added, snap_batch);
                })
                var all = document.querySelectorAll(".item-quantity");
                all.forEach(item => {               //for displaying how many items is in the inventory
                    item.innerHTML = item_num;
                })
            });

            function checkStatus(uid, snap_item_id, snap_itemn, snap_itemp, snap_manufactured, snap_expiry, snap_added, snap_batch) {
                var new_exdate = new Date(snap_expiry);
                var exdate_time = new_exdate.getTime();
                exdate_time = exdate_time - 28800000;
                var month = new Date().getMonth() + 1;
                var year = new Date().getFullYear();
                var day = new Date().getDate();
                var fulldate = month + "-" + day + "-" + year;
                var transtodate = new Date(fulldate);
                var crr_time = transtodate.getTime();
                var near = crr_time - exdate_time;
                var remain = Math.abs(Math.floor(near / (60 * 60 * 24)));
                remain = remain / 1000;

                //check if the item exceeded the expiry date
                if (crr_time >= exdate_time) {
                    item_exp++;
                    var expref = ref(db, `User/${uid}/Expired/` + snap_item_id);
                    var exp = document.querySelectorAll(".expired");

                    exp.forEach(item => {           //for displaying how many items is expired
                        item.innerHTML = item_exp;
                    });

                    set(expref, {
                        ex_id: snap_item_id,
                        ex_name: snap_itemn,
                        ex_price: snap_itemp,
                        ex_manufactured: snap_manufactured,
                        ex_expiry: snap_expiry,
                        ex_added: snap_added,
                        ex_batch: snap_batch
                    });
                }
                else {
                    item_at_hand++;
                    var avref = ref(db, `User/${uid}/Available/` + snap_item_id);
                    var available = document.querySelectorAll(".available");

                    available.forEach(item => {             //for displaying how many items is available
                        item.innerHTML = item_at_hand;
                    });

                    set(avref, {
                        av_id: snap_item_id,
                        av_name: snap_itemn,
                        av_price: snap_itemp,
                        av_manufactured: snap_manufactured,
                        av_expiry: snap_expiry,
                        av_added: snap_added,
                        av_batch: snap_batch
                    });

                    //to check if the item is going to expire within month.
                    if (remain <= 31) {
                        item_near++;
                        var near = document.querySelectorAll(".almost");
                        var toexref = ref(db, `User/${uid}/To Expire/` + snap_item_id);
                        toex_id.push(snap_item_id);         //push in array for later use

                        near.forEach(item => {              //for displaying how many items is to expired
                            item.innerHTML = item_near;
                        });

                        set(toexref, {
                            toex_id: snap_item_id,
                            toex_name: snap_itemn,
                            toex_price: snap_itemp,
                            toex_manufactured: snap_manufactured,
                            toex_expiry: snap_expiry,
                            toex_added: snap_added,
                            toex_batch: snap_batch
                        });

                        createTable(snap_item_id, snap_itemn, snap_itemp, snap_manufactured, snap_expiry, snap_added, snap_batch);

                        //select item-option class
                        const item_option = document.querySelectorAll(".item-option");
                        item_option.forEach(tags => {
                            var id = tags.parentElement.parentElement.firstChild.textContent;        //stored id in the table
                            tags.onclick = () => {
                                var opened = document.querySelectorAll(".opened");
                                if (opened.length == 0) {
                                    showItemOption(id)      //this function would create another element below the option button
                                } else {
                                    hideContainers();
                                    showItemOption(id);
                                }
                            };
                        })

                    }
                }
            }
        };

        function checkScreen() {
            var screen_size = screen.width; //get the user's screen size
            var browser_size = window.innerWidth; //get the user's browser size
            if (screen_size < 1061 || browser_size < 1061) {
                document.querySelector("main").style.display = "flex";
                document.querySelector(".add-item-section").style.display = "none";
                var items_dis = document.querySelector(".items-container");
                items_dis.style.display = "block";
            }
        }

        function search() {
            const uid = auth.currentUser.uid;
            var seach_value = document.querySelector(".search").value;
            var reff = query(ref(db, `User/${uid}/To Expire`), orderByChild("toex_name"), startAt(seach_value), endAt(seach_value + "\uf8ff"));
            removeTable();
            get(reff).then((snappy) => {
                snappy.forEach(chld => {
                    var srchdata = chld.val();
                    var srchid = chld.key;
                    var srchname = srchdata.toex_name;
                    var srchprice = srchdata.toex_price;
                    var srchmanu = srchdata.toex_manufactured;
                    var srchexp = srchdata.toex_expiry;
                    var srchadd = srchdata.toex_added;
                    var srchbatch = srchdata.toex_batch;

                    createTable(srchid, srchname, srchprice, srchmanu, srchexp, srchadd, srchbatch);

                    //select item-option class
                    const item_option = document.querySelectorAll(".item-option");
                    item_option.forEach(tags => {
                        var id = tags.parentElement.parentElement.firstChild.textContent;        //stored id in the table
                        tags.onclick = () => {
                            var opened = document.querySelectorAll(".opened");
                            if (opened.length == 0) {
                                showItemOption(id)      //this function would create another element below the option button
                            } else {
                                hideContainers();
                                showItemOption(id);
                            }
                        };
                    })
                })
            })
        };

        function getRecent() {
            const uid = auth.currentUser.uid;
            const queryy = query(ref(db, `User/${uid}/Items`), orderByChild("added"), limitToLast(5));
            const ol_tag = document.querySelector(".recent-items");
            get(queryy)
                .then(result => {
                    result.forEach(item => {
                        const data = item.val();
                        const date = new Date(data.added);
                        const string_date = date.toDateString();
                        const info = `<div>
                                        <span style="color: #7E7E7E; font-size: 13px">${item.key}</span>
                                        <div style="display: flex; align-items: center; justify-content: space-between;">
                                            <h3>${data.item_name}</h3>
                                            <p>${data.item_price}</p>
                                        </div>
                                        <div style="display: flex; align-items: center; justify-content: space-between;">
                                            <span>Price: ${data.item_price}</span>
                                            <p style="font-size: 13px">${string_date}</p>
                                        </div>
                                    </div>`;
                        const li = document.createElement("li");
                        li.innerHTML = info;
                        li.style.fontFamily = "Poppins";
                        li.classList.add("recent");
                        ol_tag.append(li);
                    })
                })
                .catch(err => {
                    console.error(err);
                })
        }

        function deleteTable() {
            var uid = auth.currentUser.uid;
            var ask = confirm("Delete your saved items?");
            hideContainers();
            if (ask) {
                for (let i = 0; i < toex_id.length; i++) {
                    var id = toex_id[i];
                    remove(ref(db, `User/${uid}/Items/` + id));
                }
                location.reload();
            }
        }
    </script>
    <script src="../index.js"></script>
</body>

</html>