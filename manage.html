<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./design.css">
    <link rel="stylesheet" href="./responsive.css">

    <title>Manage account | Inventory System</title>
</head>

<body>
    <header>
        <div class="web-name">Store Inventory</div>
    </header>
    <main>
        <div class="main-container align-center padding1"
            style="display: unset; font-family: poppins; max-width: 700px;">
            <br>
            <h1 align="center">Manage account</h1>
            <br>
            <div class="flex align-center justify-center" style="width: 100%;">
                <img src="" alt="img" class="profile-img" style="border-radius: 50%; width: 3rem; height: 3rem;">
            </div>
            <div class="account-info padding1">
                <table style="width: 80%; margin: auto;">
                    <tr>
                        <td class="padding1"><b>Email</b></td>
                        <td><input type="text" id="user-email" class="account-input" style="border: none;"></td>
                        <td><a href="#" class="edit-email">edit</a></td>
                    </tr>
                    <tr>
                        <td class="padding1"><b>Password</b></td>
                        <td><input type="text" class="account-input manage-password" style="border: none;"></td>
                        <td><a href="#" class="edit-password">edit</a></td>
                    </tr>
                    <tr class="tr-repass" style="display: none;">
                        <td class="padding1"><b>Re-password</b></td>
                        <td><input type="text" class="account-input manage-repassword" style="border: none;"></td>
                    </tr>
                    <tr class="tr-save" style="display: none;">
                        <td colspan="3" style="text-align: right;" class="padding1">
                            <button style="font-family: poppins; padding: 0.5rem;">Save</button>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3" style="text-align: center;" class="padding1">
                            <a href="" style="color: #FF3131;" class="delete-account">Delete account</a>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </main>
    <div style="height: 5rem; width: 100%;"></div>
    <script src="config.js" type="module"></script>
    <script type="module">
        import firebaseConfig from "./config.js";
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();

        var is_Anonymous = "";

        onAuthStateChanged(auth, (user) => {
            const profile = document.querySelector(".profile-img");     //select class for profile picture
            if (!user) {
                window.location = "index.html";
            }
            else if (user.isAnonymous != true) {        //check if user is not signed in as anonymous
                user.emailVerified != true ? window.location = "verify.html" : user;        //if not check if the email of user is verified, if not go to verify.html
                profile.setAttribute("src", `${user.photoURL}`);        //if user is signed in using email set the profile the same as the user's google profile picture
            }
            else if (user.isAnonymous == true) {            //check if user is anonymous
                is_Anonymous = true;                        //set the variable's is_Anonymous value to true
                profile.setAttribute("src", "./images/g-solid.svg");        //if guest set the profile as the given src
            }
            document.querySelector("#user-email").value = user.email;       //select user email input tag and store the user's email as value
        });

        const edit_pass = document.querySelector(".edit-email");    //select edit button for email
        const email = document.querySelector("#user-email");        //select input tag for email
        edit_pass.addEventListener("click", () => {
            email.classList.remove("account-input");                //remove the class account-input if edit is clicked
        });

        const trsave = document.querySelector(".tr-save");          //select tr that have the save button
        email.addEventListener("change", () => {
            trsave.style.display = "block";                         //display save button if there are changes in email input tag
        });

        const delete_account = document.querySelector(".delete-account");       //select class of delete button
        delete_account.addEventListener("click", () => {
            var result = confirm("Proceed deleting your account?");             //confirm if the user would want to delete its account
            if (result) {                                                       //if true delete the account and signout
                var user = auth.currentUser;
                deleteUser(user);               //method for deleting user account
                auth.signOut();
            }
        })
    </script>
</body>

</html>